{
  "strategy": "Prioritize testing critical AI provider interactions, rate limiting, response parsing, and retry logic as these are error-prone and affect core functionality. Focus on integration points between providers and handlers, then branch into code analysis features. Use mocks for external API calls, file system operations, and AI provider SDKs. Target 70% coverage starting with high-risk paths.",
  "total_functions": 1176,
  "testable_functions": 950,
  "function_groups": [
    {
      "group_id": "ai-providers",
      "name": "AI Provider Integration",
      "priority": 1,
      "functions": [
        {
          "name": "createProvider (switch)",
          "file": "src/ai/providers/providerFactory.ts",
          "startLine": 23,
          "endLine": 38,
          "complexity": "high",
          "dependencies": [
            "AnthropicProvider",
            "OpenAIProvider",
            "config"
          ],
          "mocking_needed": true,
          "rationale": "Critical factory pattern - all AI interactions flow through here"
        },
        {
          "name": "constructor (AnthropicProvider)",
          "file": "src/ai/providers/anthropicProvider.ts",
          "startLine": 14,
          "endLine": 16,
          "complexity": "low",
          "dependencies": [
            "Anthropic SDK"
          ],
          "mocking_needed": true,
          "rationale": "Primary provider initialization"
        },
        {
          "name": "validateConfig (if)",
          "file": "src/ai/providers/anthropicProvider.ts",
          "startLine": 20,
          "endLine": 26,
          "complexity": "medium",
          "dependencies": [
            "config validation"
          ],
          "mocking_needed": false,
          "rationale": "Configuration validation prevents runtime failures"
        },
        {
          "name": "sendRequest (if)",
          "file": "src/ai/providers/anthropicProvider.ts",
          "startLine": 41,
          "endLine": 43,
          "complexity": "high",
          "dependencies": [
            "Anthropic API",
            "rateLimiter",
            "retryHandler"
          ],
          "mocking_needed": true,
          "rationale": "Core request execution path"
        },
        {
          "name": "constructor (OpenAIProvider)",
          "file": "src/ai/providers/openAIProvider.ts",
          "startLine": 14,
          "endLine": 16,
          "complexity": "low",
          "dependencies": [
            "OpenAI SDK"
          ],
          "mocking_needed": true,
          "rationale": "Secondary provider initialization"
        },
        {
          "name": "validateConfig (if)",
          "file": "src/ai/providers/openAIProvider.ts",
          "startLine": 20,
          "endLine": 26,
          "complexity": "medium",
          "dependencies": [
            "config validation"
          ],
          "mocking_needed": false,
          "rationale": "Configuration validation prevents runtime failures"
        },
        {
          "name": "sendRequest (if)",
          "file": "src/ai/providers/openAIProvider.ts",
          "startLine": 41,
          "endLine": 43,
          "complexity": "high",
          "dependencies": [
            "OpenAI API",
            "rateLimiter",
            "retryHandler"
          ],
          "mocking_needed": true,
          "rationale": "Core request execution path"
        }
      ]
    },
    {
      "group_id": "rate-limiting",
      "name": "Rate Limiting & Resource Management",
      "priority": 2,
      "functions": [
        {
          "name": "constructor (RateLimiter)",
          "file": "src/ai/llmRateLimiter.ts",
          "startLine": 20,
          "endLine": 33,
          "complexity": "medium",
          "dependencies": [
            "config"
          ],
          "mocking_needed": false,
          "rationale": "Initializes rate limiting parameters - critical for API quota management"
        },
        {
          "name": "acquireToken (if)",
          "file": "src/ai/llmRateLimiter.ts",
          "startLine": 47,
          "endLine": 49,
          "complexity": "high",
          "dependencies": [
            "token bucket",
            "time management"
          ],
          "mocking_needed": true,
          "rationale": "Controls request throttling - prevents API overuse"
        },
        {
          "name": "checkQuota (if)",
          "file": "src/ai/llmRateLimiter.ts",
          "startLine": 81,
          "endLine": 83,
          "complexity": "medium",
          "dependencies": [
            "quota tracking"
          ],
          "mocking_needed": false,
          "rationale": "Prevents quota exhaustion"
        },
        {
          "name": "waitTime",
          "file": "src/ai/llmRateLimiter.ts",
          "startLine": 100,
          "endLine": 105,
          "complexity": "medium",
          "dependencies": [
            "time calculations"
          ],
          "mocking_needed": true,
          "rationale": "Calculates backoff delays - affects retry behavior"
        },
        {
          "name": "waitTime nested (if)",
          "file": "src/ai/llmRateLimiter.ts",
          "startLine": 102,
          "endLine": 105,
          "complexity": "low",
          "dependencies": [
            "time calculations"
          ],
          "mocking_needed": true,
          "rationale": "Edge case handling in wait calculations"
        }
      ]
    },
    {
      "group_id": "retry-handler",
      "name": "Retry Logic & Error Handling",
      "priority": 3,
      "functions": [
        {
          "name": "executeWithRetry (for)",
          "file": "src/ai/llmRetryHandler.ts",
          "startLine": 60,
          "endLine": 90,
          "complexity": "high",
          "dependencies": [
            "retryPolicy",
            "errorClassification",
            "delays"
          ],
          "mocking_needed": true,
          "rationale": "Core retry orchestration - handles transient failures"
        },
        {
          "name": "shouldRetry (if)",
          "file": "src/ai/llmRetryHandler.ts",
          "startLine": 68,
          "endLine": 70,
          "complexity": "high",
          "dependencies": [
            "error type detection"
          ],
          "mocking_needed": false,
          "rationale": "Determines retry eligibility - critical decision point"
        },
        {
          "name": "backoffDelay (if)",
          "file": "src/ai/llmRetryHandler.ts",
          "startLine": 78,
          "endLine": 80,
          "complexity": "medium",
          "dependencies": [
            "exponential backoff"
          ],
          "mocking_needed": true,
          "rationale": "Calculates retry delays - affects system load"
        },
        {
          "name": "isRetryableError (if)",
          "file": "src/ai/llmRetryHandler.ts",
          "startLine": 100,
          "endLine": 102,
          "complexity": "medium",
          "dependencies": [
            "error codes"
          ],
          "mocking_needed": false,
          "rationale": "Error classification affects retry behavior"
        },
        {
          "name": "errorMessage/errorCode",
          "file": "src/ai/llmRetryHandler.ts",
          "startLine": 104,
          "endLine": 115,
          "complexity": "medium",
          "dependencies": [
            "error parsing"
          ],
          "mocking_needed": false,
          "rationale": "Extracts error details for logging and debugging"
        }
      ]
    },
    {
      "group_id": "response-parser",
      "name": "LLM Response Parsing",
      "priority": 4,
      "functions": [
        {
          "name": "parseResponse (if)",
          "file": "src/ai/llmResponseParser.ts",
          "startLine": 17,
          "endLine": 30,
          "complexity": "high",
          "dependencies": [
            "JSON parsing",
            "validation"
          ],
          "mocking_needed": false,
          "rationale": "Main entry point for all response processing"
        },
        {
          "name": "extractJSON (if)",
          "file": "src/ai/llmResponseParser.ts",
          "startLine": 60,
          "endLine": 72,
          "complexity": "high",
          "dependencies": [
            "regex",
            "JSON extraction"
          ],
          "mocking_needed": false,
          "rationale": "Handles malformed responses - common failure point"
        },
        {
          "name": "validateStructure (for)",
          "file": "src/ai/llmResponseParser.ts",
          "startLine": 109,
          "endLine": 115,
          "complexity": "medium",
          "dependencies": [
            "schema validation"
          ],
          "mocking_needed": false,
          "rationale": "Ensures response integrity"
        },
        {
          "name": "parseCodeBlocks (for)",
          "file": "src/ai/llmResponseParser.ts",
          "startLine": 313,
          "endLine": 348,
          "complexity": "high",
          "dependencies": [
            "regex",
            "string parsing"
          ],
          "mocking_needed": false,
          "rationale": "Extracts code from responses - core feature"
        },
        {
          "name": "parseCodeBlocks nested (if)",
          "file": "src/ai/llmResponseParser.ts",
          "startLine": 323,
          "endLine": 344,
          "complexity": "high",
          "dependencies": [
            "language detection",
            "code extraction"
          ],
          "mocking_needed": false,
          "rationale": "Complex parsing logic with multiple branches"
        },
        {
          "name": "sanitizeResponse (for)",
          "file": "src/ai/llmResponseParser.ts",
          "startLine": 390,
          "endLine": 439,
          "complexity": "high",
          "dependencies": [
            "string manipulation",
            "XSS prevention"
          ],
          "mocking_needed": false,
          "rationale": "Security-critical sanitization"
        }
      ]
    },
    {
      "group_id": "code-analysis",
      "name": "Enhanced Code Analysis",
      "priority": 5,
      "functions": [
        {
          "name": "analyzeFiles (for)",
          "file": "src/analysis/enhancedAnalyzer.ts",
          "startLine": 31,
          "endLine": 58,
          "complexity": "high",
          "dependencies": [
            "file system",
            "AST parser",
            "complexity calculator"
          ],
          "mocking_needed": true,
          "rationale": "Main analysis orchestration - processes multiple files"
        },
        {
          "name": "parseFile (if)",
          "file": "src/analysis/enhancedAnalyzer.ts",
          "startLine": 40,
          "endLine": 47,
          "complexity": "medium",
          "dependencies": [
            "TypeScript parser",
            "file IO"
          ],
          "mocking_needed": true,
          "rationale": "Parses source code - foundation for all analysis"
        },
        {
          "name": "extractFunctions (for)",
          "file": "src/analysis/enhancedAnalyzer.ts",
          "startLine": 488,
          "endLine": 617,
          "complexity": "high",
          "dependencies": [
            "AST traversal",
            "function detection"
          ],
          "mocking_needed": false,
          "rationale": "Core function extraction - 130 lines of complex logic"
        },
        {
          "name": "visit (AST traversal)",
          "file": "src/analysis/enhancedAnalyzer.ts",
          "startLine": 104,
          "endLine": 122,
          "complexity": "high",
          "dependencies": [
            "AST nodes",
            "visitor pattern"
          ],
          "mocking_needed": false,
          "rationale": "AST traversal logic - used throughout analysis"
        },
        {
          "name": "calculateComplexity (for)",
          "file": "src/analysis/enhancedAnalyzer.ts",
          "startLine": 693,
          "endLine": 719,
          "complexity": "high",
          "dependencies": [
            "cyclomatic complexity",
            "AST"
          ],
          "mocking_needed": false,
          "rationale": "Complexity metrics - key quality indicator"
        },
        {
          "name": "traverse (recursive)",
          "file": "src/analysis/enhancedAnalyzer.ts",
          "startLine": 744,
          "endLine": 771,
          "complexity": "high",
          "dependencies": [
            "recursive traversal",
            "AST"
          ],
          "mocking_needed": false,
          "rationale": "Recursive AST navigation - can cause stack issues"
        }
      ]
    },
    {
      "group_id": "provider-helpers",
      "name": "Provider Helper Functions",
      "priority": 6,
      "functions": [
        {
          "name": "formatRequest (Anthropic)",
          "file": "src/ai/providers/anthropicProvider.ts",
          "startLine": 63,
          "endLine": 65,
          "complexity": "medium",
          "dependencies": [
            "message formatting"
          ],
          "mocking_needed": false,
          "rationale": "Formats requests for Anthropic API"
        },
        {
          "name": "parseResponse (Anthropic)",
          "file": "src/ai/providers/anthropicProvider.ts",
          "startLine": 79,
          "endLine": 81,
          "complexity": "medium",
          "dependencies": [
            "response parser"
          ],
          "mocking_needed": false,
          "rationale": "Parses Anthropic-specific responses"
        },
        {
          "name": "getRateLimits (Anthropic)",
          "file": "src/ai/providers/anthropicProvider.ts",
          "startLine": 121,
          "endLine": 126,
          "complexity": "low",
          "dependencies": [
            "rate limit config"
          ],
          "mocking_needed": false,
          "rationale": "Returns provider-specific rate limits"
        },
        {
          "name": "formatMessages (OpenAI, for)",
          "file": "src/ai/providers/openAIProvider.ts",
          "startLine": 120,
          "endLine": 133,
          "complexity": "medium",
          "dependencies": [
            "message formatting"
          ],
          "mocking_needed": false,
          "rationale": "Formats messages for OpenAI API"
        },
        {
          "name": "handleStreamResponse (OpenAI)",
          "file": "src/ai/providers/openAIProvider.ts",
          "startLine": 89,
          "endLine": 94,
          "complexity": "high",
          "dependencies": [
            "streaming",
            "event handling"
          ],
          "mocking_needed": true,
          "rationale": "Handles streaming responses - complex async logic"
        }
      ]
    }
  ],
  "test_priorities": {
    "critical_paths": [
      "AI provider initialization → request formatting → API call → response parsing",
      "Rate limiter token acquisition → quota checking → request execution",
      "Retry handler error classification → backoff calculation → retry attempt",
      "File analysis → AST parsing → function extraction → complexity calculation"
    ],
    "edge_cases": [
      "Malformed JSON responses from LLM",
      "Rate limit exhaustion scenarios",
      "Network timeout and retry exhaustion",
      "Invalid TypeScript syntax in analyzed files",
      "Deeply nested AST structures causing stack overflow"
    ],
    "integration_tests": [
      "End-to-end provider factory → provider → rate limiter → retry handler flow",
      "Complete analysis pipeline from file input to structured output",
      "Error propagation through retry and rate limiting layers"
    ]
  },
  "mocking_strategy": {
    "external_apis": [
      "Anthropic SDK methods",
      "OpenAI SDK methods",
      "File system operations (fs.readFile, fs.writeFile)",
      "Timer functions (setTimeout, Date.now)"
    ],
    "internal_modules": [
      "Rate limiter for isolated provider tests",
      "Retry handler for isolated provider tests",
      "Response parser for retry handler tests"
    ]
  },
  "coverage_targets": {
    "critical_modules": "90%",
    "high_priority": "80%",
    "medium_priority": "70%",
    "overall_target": "75%"
  },
  "estimated_effort": {
    "ai_providers_group": "3-4 days",
    "rate_limiting_group": "2 days",
    "retry_handler_group": "2-3 days",
    "response_parser_group": "3 days",
    "code_analysis_group": "4-5 days",
    "total_for_top_30": "14-17 days"
  }
}