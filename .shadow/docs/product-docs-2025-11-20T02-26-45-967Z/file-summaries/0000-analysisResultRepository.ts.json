{
  "file": "src/infrastructure/persistence/analysisResultRepository.ts",
  "role": "Core Logic",
  "purpose": "Manages storage and retrieval of code analysis results including product documentation, architecture insights, and summaries to the .shadow directory.",
  "userVisibleActions": [
    "Generated documentation files are saved to timestamped directories in .shadow/docs",
    "Architecture insights are saved to timestamped directories in .shadow/architecture",
    "Individual file documentation is stored with metadata for tracking",
    "Analysis results are organized by run with unique identifiers",
    "Summary files and overview documentation are created for each analysis run"
  ],
  "developerVisibleActions": [
    "Initialize documentation runs with timestamped directories",
    "Save enhanced product documentation for individual files",
    "Store architecture insights and summaries",
    "Retrieve current run directories for accessing results",
    "Create structured output with metadata tracking",
    "Generate formatted documentation in markdown",
    "Manage incremental storage for documentation updates"
  ],
  "keyFunctions": [
    {
      "name": "initializeProductDocsRun",
      "desc": "Creates a new timestamped directory for storing product documentation results",
      "inputs": "workspaceRoot (string)",
      "outputs": "runDir path (string)"
    },
    {
      "name": "initializeArchitectureInsightsRun",
      "desc": "Creates a new timestamped directory for storing architecture analysis results",
      "inputs": "workspaceRoot (string)",
      "outputs": "runDir path (string)"
    },
    {
      "name": "saveProductDocumentation",
      "desc": "Saves enhanced product documentation for a file to the current run directory",
      "inputs": "filePath (string), documentation (EnhancedProductDocumentation), workspaceRoot (string)",
      "outputs": "saved file path (string)"
    },
    {
      "name": "saveArchitectureInsights",
      "desc": "Saves architecture insights and analysis summaries to the current run directory",
      "inputs": "insights (LLMInsights), workspaceRoot (string), summary (optional string)",
      "outputs": "saved file paths object"
    },
    {
      "name": "getCurrentProductDocsRunDir",
      "desc": "Returns the directory path of the current product documentation run",
      "inputs": "none",
      "outputs": "runDir path (string) or null"
    },
    {
      "name": "getCurrentArchitectureInsightsRunDir",
      "desc": "Returns the directory path of the current architecture insights run",
      "inputs": "none",
      "outputs": "runDir path (string) or null"
    },
    {
      "name": "resetProductDocsRun",
      "desc": "Clears the current product documentation run context",
      "inputs": "none",
      "outputs": "void"
    },
    {
      "name": "resetArchitectureInsightsRun",
      "desc": "Clears the current architecture insights run context",
      "inputs": "none",
      "outputs": "void"
    },
    {
      "name": "saveSummary",
      "desc": "Saves a summary file to the specified run directory",
      "inputs": "runDir (string), summary (string)",
      "outputs": "saved file path (string)"
    }
  ],
  "dependencies": [
    "vscode",
    "fs",
    "path",
    "../../fileDocumentation",
    "../../llmService",
    "../../domain/formatters/documentationFormatter",
    "../../storage/incrementalStorage"
  ],
  "intent": "This file exists to separate persistence concerns from the LLM integration logic, providing a dedicated layer for storing and organizing analysis results in a structured, timestamped manner so that documentation and insights can be tracked across multiple analysis runs.",
  "rawContent": "```json\n{\n  \"purpose\": \"Manages storage and retrieval of code analysis results including product documentation, architecture insights, and summaries to the .shadow directory.\",\n  \"userVisibleActions\": [\n    \"Generated documentation files are saved to timestamped directories in .shadow/docs\",\n    \"Architecture insights are saved to timestamped directories in .shadow/architecture\",\n    \"Individual file documentation is stored with metadata for tracking\",\n    \"Analysis results are organized by run with unique identifiers\",\n    \"Summary files and overview documentation are created for each analysis run\"\n  ],\n  \"developerVisibleActions\": [\n    \"Initialize documentation runs with timestamped directories\",\n    \"Save enhanced product documentation for individual files\",\n    \"Store architecture insights and summaries\",\n    \"Retrieve current run directories for accessing results\",\n    \"Create structured output with metadata tracking\",\n    \"Generate formatted documentation in markdown\",\n    \"Manage incremental storage for documentation updates\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"initializeProductDocsRun\",\n      \"desc\": \"Creates a new timestamped directory for storing product documentation results\",\n      \"inputs\": \"workspaceRoot (string)\",\n      \"outputs\": \"runDir path (string)\"\n    },\n    {\n      \"name\": \"initializeArchitectureInsightsRun\",\n      \"desc\": \"Creates a new timestamped directory for storing architecture analysis results\",\n      \"inputs\": \"workspaceRoot (string)\",\n      \"outputs\": \"runDir path (string)\"\n    },\n    {\n      \"name\": \"saveProductDocumentation\",\n      \"desc\": \"Saves enhanced product documentation for a file to the current run directory\",\n      \"inputs\": \"filePath (string), documentation (EnhancedProductDocumentation), workspaceRoot (string)\",\n      \"outputs\": \"saved file path (string)\"\n    },\n    {\n      \"name\": \"saveArchitectureInsights\",\n      \"desc\": \"Saves architecture insights and analysis summaries to the current run directory\",\n      \"inputs\": \"insights (LLMInsights), workspaceRoot (string), summary (optional string)\",\n      \"outputs\": \"saved file paths object\"\n    },\n    {\n      \"name\": \"getCurrentProductDocsRunDir\",\n      \"desc\": \"Returns the directory path of the current product documentation run\",\n      \"inputs\": \"none\",\n      \"outputs\": \"runDir path (string) or null\"\n    },\n    {\n      \"name\": \"getCurrentArchitectureInsightsRunDir\",\n      \"desc\": \"Returns the directory path of the current architecture insights run\",\n      \"inputs\": \"none\",\n      \"outputs\": \"runDir path (string) or null\"\n    },\n    {\n      \"name\": \"resetProductDocsRun\",\n      \"desc\": \"Clears the current product documentation run context\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"resetArchitectureInsightsRun\",\n      \"desc\": \"Clears the current architecture insights run context\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"saveSummary\",\n      \"desc\": \"Saves a summary file to the specified run directory\",\n      \"inputs\": \"runDir (string), summary (string)\",\n      \"outputs\": \"saved file path (string)\"\n    }\n  ],\n  \"dependencies\": [\n    \"vscode\",\n    \"fs\",\n    \"path\",\n    \"../../fileDocumentation\",\n    \"../../llmService\",\n    \"../../domain/formatters/documentationFormatter\",\n    \"../../storage/incrementalStorage\"\n  ],\n  \"intent\": \"This file exists to separate persistence concerns from the LLM integration logic, providing a dedicated layer for storing and organizing analysis results in a structured, timestamped manner so that documentation and insights can be tracked across multiple analysis runs.\"\n}\n```",
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-20T02:43:25.663Z"
  }
}