{
  "file": "src/cache.ts",
  "role": "Core Logic",
  "purpose": "Manages persistent storage and retrieval of code analysis results with automatic expiration",
  "userVisibleActions": [
    "Faster workspace analysis on subsequent loads (cached results loaded instantly)",
    "Automatic refresh of analysis after 24 hours to ensure accuracy",
    "Analysis cache cleared when user requests it"
  ],
  "developerVisibleActions": [
    "Extension stores analysis results in .shadowwatch-cache directory",
    "Cache files are automatically created in workspace storage path",
    "Cache entries expire after 24 hours and trigger re-analysis",
    "Failed cache operations fall back gracefully without breaking analysis",
    "Cache can be manually cleared to force fresh analysis"
  ],
  "keyFunctions": [
    {
      "name": "constructor",
      "desc": "Initializes cache storage location and ensures directory exists",
      "inputs": "storagePath: string (where to store cache files)",
      "outputs": "AnalysisCache instance"
    },
    {
      "name": "get",
      "desc": "Retrieves cached analysis for a workspace if available and not expired",
      "inputs": "workspaceRoot: string (workspace identifier)",
      "outputs": "Promise<CodeAnalysis | null> (cached data or null if missing/expired)"
    },
    {
      "name": "set",
      "desc": "Saves analysis results to cache with current timestamp",
      "inputs": "workspaceRoot: string, data: CodeAnalysis (analysis to cache)",
      "outputs": "Promise<void>"
    },
    {
      "name": "clear",
      "desc": "Removes all cached analysis files from storage",
      "inputs": "none",
      "outputs": "Promise<void>"
    },
    {
      "name": "getCacheKey",
      "desc": "Generates safe filename from workspace path",
      "inputs": "workspaceRoot: string",
      "outputs": "string (base64-encoded safe filename)"
    }
  ],
  "dependencies": [
    "fs",
    "path",
    "./analyzer (CodeAnalysis type)"
  ],
  "intent": "Improves extension performance by caching expensive code analysis results, reducing repeated analysis of unchanged workspaces while ensuring data freshness through automatic expiration",
  "rawContent": "```json\n{\n  \"purpose\": \"Manages persistent storage and retrieval of code analysis results with automatic expiration\",\n  \"userVisibleActions\": [\n    \"Faster workspace analysis on subsequent loads (cached results loaded instantly)\",\n    \"Automatic refresh of analysis after 24 hours to ensure accuracy\",\n    \"Analysis cache cleared when user requests it\"\n  ],\n  \"developerVisibleActions\": [\n    \"Extension stores analysis results in .shadowwatch-cache directory\",\n    \"Cache files are automatically created in workspace storage path\",\n    \"Cache entries expire after 24 hours and trigger re-analysis\",\n    \"Failed cache operations fall back gracefully without breaking analysis\",\n    \"Cache can be manually cleared to force fresh analysis\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"constructor\",\n      \"desc\": \"Initializes cache storage location and ensures directory exists\",\n      \"inputs\": \"storagePath: string (where to store cache files)\",\n      \"outputs\": \"AnalysisCache instance\"\n    },\n    {\n      \"name\": \"get\",\n      \"desc\": \"Retrieves cached analysis for a workspace if available and not expired\",\n      \"inputs\": \"workspaceRoot: string (workspace identifier)\",\n      \"outputs\": \"Promise<CodeAnalysis | null> (cached data or null if missing/expired)\"\n    },\n    {\n      \"name\": \"set\",\n      \"desc\": \"Saves analysis results to cache with current timestamp\",\n      \"inputs\": \"workspaceRoot: string, data: CodeAnalysis (analysis to cache)\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"clear\",\n      \"desc\": \"Removes all cached analysis files from storage\",\n      \"inputs\": \"none\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"getCacheKey\",\n      \"desc\": \"Generates safe filename from workspace path\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"string (base64-encoded safe filename)\"\n    }\n  ],\n  \"dependencies\": [\n    \"fs\",\n    \"path\",\n    \"./analyzer (CodeAnalysis type)\"\n  ],\n  \"intent\": \"Improves extension performance by caching expensive code analysis results, reducing repeated analysis of unchanged workspaces while ensuring data freshness through automatic expiration\"\n}\n```",
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-20T06:29:03.096Z"
  }
}