{
  "file": "src/domain/prompts/refactoringPromptBuilder.ts",
  "role": "Core Logic",
  "purpose": "Builds structured prompts for LLM-based code refactoring that include detailed analysis, extraction plans, and prescriptive instructions.",
  "userVisibleActions": [
    "Receives detailed refactoring recommendations with step-by-step migration plans",
    "Gets code examples showing before/after states for proposed refactorings",
    "Sees function-by-function analysis explaining why code should be extracted or reorganized",
    "Views dependency relationships between functions to understand extraction impact"
  ],
  "developerVisibleActions": [
    "Generates comprehensive refactoring prompts by combining code analysis, product documentation, and architecture insights",
    "Creates structured extraction plans that identify functions to move and their dependencies",
    "Produces prompts that request specific refactoring formats including migration steps and code examples",
    "Builds function analysis sections showing responsibilities, dependencies, and dependents for each function",
    "Formats prompts to guide LLMs in providing prescriptive refactoring instructions rather than general advice"
  ],
  "keyFunctions": [
    {
      "name": "buildDetailedRefactoringPrompt",
      "desc": "Constructs a comprehensive refactoring prompt by combining analysis context, code analysis, product documentation, architecture insights, and function analyses",
      "inputs": "AnalysisContext, CodeAnalysis, optional EnhancedProductDocumentation, optional LLMInsights, optional FunctionAnalysis array",
      "outputs": "Formatted string prompt for LLM consumption"
    },
    {
      "name": "buildBasePrompt",
      "desc": "Creates the foundational prompt structure including context, code analysis, and documentation",
      "inputs": "AnalysisContext, CodeAnalysis, optional product docs, optional architecture insights",
      "outputs": "Base prompt string"
    },
    {
      "name": "buildFunctionAnalysisSection",
      "desc": "Formats function-level analysis data into prompt text showing signatures, dependencies, and responsibilities",
      "inputs": "Array of FunctionAnalysis objects",
      "outputs": "Formatted function analysis section string"
    },
    {
      "name": "buildExtractionRequirementsSection",
      "desc": "Generates prompt section specifying what format and details the refactoring recommendations should include",
      "inputs": "None",
      "outputs": "Extraction requirements section string"
    }
  ],
  "dependencies": [
    "../../analyzer (CodeAnalysis, FileInfo, FunctionMetadata)",
    "../../llmService (AnalysisContext, LLMInsights)",
    "../../fileDocumentation (EnhancedProductDocumentation)"
  ],
  "intent": "This file exists to transform raw code analysis data into structured, detailed prompts that guide LLMs to produce actionable refactoring recommendations with specific extraction plans, migration steps, and code examples rather than vague suggestions.",
  "rawContent": "```json\n{\n  \"purpose\": \"Builds structured prompts for LLM-based code refactoring that include detailed analysis, extraction plans, and prescriptive instructions.\",\n  \"userVisibleActions\": [\n    \"Receives detailed refactoring recommendations with step-by-step migration plans\",\n    \"Gets code examples showing before/after states for proposed refactorings\",\n    \"Sees function-by-function analysis explaining why code should be extracted or reorganized\",\n    \"Views dependency relationships between functions to understand extraction impact\"\n  ],\n  \"developerVisibleActions\": [\n    \"Generates comprehensive refactoring prompts by combining code analysis, product documentation, and architecture insights\",\n    \"Creates structured extraction plans that identify functions to move and their dependencies\",\n    \"Produces prompts that request specific refactoring formats including migration steps and code examples\",\n    \"Builds function analysis sections showing responsibilities, dependencies, and dependents for each function\",\n    \"Formats prompts to guide LLMs in providing prescriptive refactoring instructions rather than general advice\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"buildDetailedRefactoringPrompt\",\n      \"desc\": \"Constructs a comprehensive refactoring prompt by combining analysis context, code analysis, product documentation, architecture insights, and function analyses\",\n      \"inputs\": \"AnalysisContext, CodeAnalysis, optional EnhancedProductDocumentation, optional LLMInsights, optional FunctionAnalysis array\",\n      \"outputs\": \"Formatted string prompt for LLM consumption\"\n    },\n    {\n      \"name\": \"buildBasePrompt\",\n      \"desc\": \"Creates the foundational prompt structure including context, code analysis, and documentation\",\n      \"inputs\": \"AnalysisContext, CodeAnalysis, optional product docs, optional architecture insights\",\n      \"outputs\": \"Base prompt string\"\n    },\n    {\n      \"name\": \"buildFunctionAnalysisSection\",\n      \"desc\": \"Formats function-level analysis data into prompt text showing signatures, dependencies, and responsibilities\",\n      \"inputs\": \"Array of FunctionAnalysis objects\",\n      \"outputs\": \"Formatted function analysis section string\"\n    },\n    {\n      \"name\": \"buildExtractionRequirementsSection\",\n      \"desc\": \"Generates prompt section specifying what format and details the refactoring recommendations should include\",\n      \"inputs\": \"None\",\n      \"outputs\": \"Extraction requirements section string\"\n    }\n  ],\n  \"dependencies\": [\n    \"../../analyzer (CodeAnalysis, FileInfo, FunctionMetadata)\",\n    \"../../llmService (AnalysisContext, LLMInsights)\",\n    \"../../fileDocumentation (EnhancedProductDocumentation)\"\n  ],\n  \"intent\": \"This file exists to transform raw code analysis data into structured, detailed prompts that guide LLMs to produce actionable refactoring recommendations with specific extraction plans, migration steps, and code examples rather than vague suggestions.\"\n}\n```",
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-20T00:52:47.815Z"
  }
}