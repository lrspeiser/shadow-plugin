{
  "module": "src/infrastructure/persistence",
  "moduleType": "other",
  "capabilities": [
    "Persistent storage of code analysis results in organized, timestamped directory structures",
    "Automatic generation and saving of product documentation for analyzed codebases",
    "Storage of architecture insights and patterns discovered during analysis",
    "Creation of code summaries with statistics and metadata",
    "Maintenance of a 'latest' reference for easy access to most recent analysis",
    "Structured organization of analysis runs with complete metadata and timing information"
  ],
  "summary": "The persistence module provides comprehensive storage capabilities for code analysis results. It manages a structured file system under .shadow/docs where each analysis run is stored in a timestamped directory, ensuring full history and traceability of all analyses performed.\n\nUsers benefit from automatic organization of analysis outputs including product documentation, architecture insights, and code summaries. Each analysis run captures complete metadata such as execution timing, file counts, and statistics. The module maintains a 'latest' symbolic link that always points to the most recent analysis, enabling quick access to current results without needing to navigate timestamped directories.\n\nThe module handles the entire lifecycle of analysis result persistence, from initial directory creation through final metadata recording. All documentation artifacts are automatically saved with appropriate naming conventions and directory structures, making it easy to review past analyses, track changes over time, and access the most current understanding of a codebase.",
  "files": [
    {
      "file": "src/infrastructure/persistence/analysisResultRepository.ts",
      "role": "Core Logic",
      "purpose": "Manages the storage and retrieval of analysis results including product documentation, architecture insights, and code summaries in a timestamped directory structure.",
      "userVisibleActions": [
        "Analysis results are saved to timestamped directories under .shadow/docs",
        "Product documentation files are created for analyzed code",
        "Architecture insights are stored in dedicated run directories",
        "Summary files are generated and saved after analysis",
        "Run metadata including timing and statistics is recorded",
        "Latest analysis results are accessible in a 'latest' directory link"
      ],
      "developerVisibleActions": [
        "Initialize product documentation runs with unique timestamped identifiers",
        "Initialize architecture insights runs with separate tracking",
        "Save individual product documentation entries with formatted content",
        "Store architecture insights with LLM-generated analysis",
        "Generate and save summary markdown files after analysis completion",
        "Track run progress with metadata files (timing, file counts, token usage)",
        "Access current run directories for active analysis sessions",
        "Reset run contexts when starting new analysis operations"
      ],
      "keyFunctions": [
        {
          "name": "initializeProductDocsRun",
          "desc": "Starts a new product documentation analysis run",
          "inputs": "workspaceRoot: string",
          "outputs": "string (run directory path)"
        },
        {
          "name": "initializeArchitectureInsightsRun",
          "desc": "Starts a new architecture insights analysis run",
          "inputs": "workspaceRoot: string",
          "outputs": "string (run directory path)"
        },
        {
          "name": "saveProductDocumentation",
          "desc": "Saves formatted product documentation for a specific file",
          "inputs": "doc: EnhancedProductDocumentation, workspaceRoot: string",
          "outputs": "Promise<string> (saved file path)"
        },
        {
          "name": "saveArchitectureInsights",
          "desc": "Saves LLM-generated architecture insights to storage",
          "inputs": "insights: LLMInsights, workspaceRoot: string",
          "outputs": "Promise<string> (saved file path)"
        },
        {
          "name": "saveSummary",
          "desc": "Generates and saves a summary markdown file for the analysis run",
          "inputs": "summaryContent: string, workspaceRoot: string",
          "outputs": "Promise<string> (summary file path)"
        },
        {
          "name": "saveRunMetadata",
          "desc": "Saves metadata about the analysis run including timing and statistics",
          "inputs": "metadata: object, workspaceRoot: string",
          "outputs": "Promise<void>"
        },
        {
          "name": "getCurrentProductDocsRunDir",
          "desc": "Gets the current product docs run directory path",
          "inputs": "none",
          "outputs": "string | null"
        },
        {
          "name": "getCurrentArchitectureInsightsRunDir",
          "desc": "Gets the current architecture insights run directory path",
          "inputs": "none",
          "outputs": "string | null"
        },
        {
          "name": "resetProductDocsRun",
          "desc": "Clears the current product docs run context",
          "inputs": "none",
          "outputs": "void"
        },
        {
          "name": "resetArchitectureInsightsRun",
          "desc": "Clears the current architecture insights run context",
          "inputs": "none",
          "outputs": "void"
        }
      ],
      "dependencies": [
        "vscode",
        "fs",
        "path",
        "fileDocumentation (EnhancedProductDocumentation)",
        "llmService (LLMInsights)",
        "domain/formatters/documentationFormatter",
        "storage/incrementalStorage"
      ],
      "intent": "This file exists to separate persistence concerns from LLM integration logic, providing a dedicated repository layer for storing and organizing analysis results in a structured, timestamped manner that allows tracking multiple analysis runs and their outputs.",
      "rawContent": "```json\n{\n  \"purpose\": \"Manages the storage and retrieval of analysis results including product documentation, architecture insights, and code summaries in a timestamped directory structure.\",\n  \"userVisibleActions\": [\n    \"Analysis results are saved to timestamped directories under .shadow/docs\",\n    \"Product documentation files are created for analyzed code\",\n    \"Architecture insights are stored in dedicated run directories\",\n    \"Summary files are generated and saved after analysis\",\n    \"Run metadata including timing and statistics is recorded\",\n    \"Latest analysis results are accessible in a 'latest' directory link\"\n  ],\n  \"developerVisibleActions\": [\n    \"Initialize product documentation runs with unique timestamped identifiers\",\n    \"Initialize architecture insights runs with separate tracking\",\n    \"Save individual product documentation entries with formatted content\",\n    \"Store architecture insights with LLM-generated analysis\",\n    \"Generate and save summary markdown files after analysis completion\",\n    \"Track run progress with metadata files (timing, file counts, token usage)\",\n    \"Access current run directories for active analysis sessions\",\n    \"Reset run contexts when starting new analysis operations\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"initializeProductDocsRun\",\n      \"desc\": \"Starts a new product documentation analysis run\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"string (run directory path)\"\n    },\n    {\n      \"name\": \"initializeArchitectureInsightsRun\",\n      \"desc\": \"Starts a new architecture insights analysis run\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"string (run directory path)\"\n    },\n    {\n      \"name\": \"saveProductDocumentation\",\n      \"desc\": \"Saves formatted product documentation for a specific file\",\n      \"inputs\": \"doc: EnhancedProductDocumentation, workspaceRoot: string\",\n      \"outputs\": \"Promise<string> (saved file path)\"\n    },\n    {\n      \"name\": \"saveArchitectureInsights\",\n      \"desc\": \"Saves LLM-generated architecture insights to storage\",\n      \"inputs\": \"insights: LLMInsights, workspaceRoot: string\",\n      \"outputs\": \"Promise<string> (saved file path)\"\n    },\n    {\n      \"name\": \"saveSummary\",\n      \"desc\": \"Generates and saves a summary markdown file for the analysis run\",\n      \"inputs\": \"summaryContent: string, workspaceRoot: string\",\n      \"outputs\": \"Promise<string> (summary file path)\"\n    },\n    {\n      \"name\": \"saveRunMetadata\",\n      \"desc\": \"Saves metadata about the analysis run including timing and statistics\",\n      \"inputs\": \"metadata: object, workspaceRoot: string\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"getCurrentProductDocsRunDir\",\n      \"desc\": \"Gets the current product docs run directory path\",\n      \"inputs\": \"none\",\n      \"outputs\": \"string | null\"\n    },\n    {\n      \"name\": \"getCurrentArchitectureInsightsRunDir\",\n      \"desc\": \"Gets the current architecture insights run directory path\",\n      \"inputs\": \"none\",\n      \"outputs\": \"string | null\"\n    },\n    {\n      \"name\": \"resetProductDocsRun\",\n      \"desc\": \"Clears the current product docs run context\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"resetArchitectureInsightsRun\",\n      \"desc\": \"Clears the current architecture insights run context\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    }\n  ],\n  \"dependencies\": [\n    \"vscode\",\n    \"fs\",\n    \"path\",\n    \"fileDocumentation (EnhancedProductDocumentation)\",\n    \"llmService (LLMInsights)\",\n    \"domain/formatters/documentationFormatter\",\n    \"storage/incrementalStorage\"\n  ],\n  \"intent\": \"This file exists to separate persistence concerns from LLM integration logic, providing a dedicated repository layer for storing and organizing analysis results in a structured, timestamped manner that allows tracking multiple analysis runs and their outputs.\"\n}\n```"
    }
  ],
  "endpoints": [],
  "commands": [],
  "workers": [],
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-20T01:01:42.516Z"
  }
}