{
  "module": "src/infrastructure/persistence",
  "moduleType": "other",
  "capabilities": [
    "Automatically persists all analysis results to disk in organized directory structures",
    "Creates timestamped folders for each analysis run to maintain complete history",
    "Saves product documentation to .shadow/docs with formatted markdown content",
    "Stores architecture insights in .shadow/insights as structured reports",
    "Preserves project summaries with metadata for later review",
    "Maintains versioned analysis history for comparison and tracking changes over time"
  ],
  "summary": "The persistence module provides automatic, organized storage of all analysis results generated by Shadow. When you run analyses on your codebase, this module ensures that every result—whether product documentation, architecture insights, or project summaries—is saved to disk in a structured, timestamped format. This creates a permanent record of your analysis history.\n\nEach analysis run creates a new timestamped directory (e.g., .shadow/docs/2024-01-15_14-30-00) that contains all outputs from that session. This approach preserves the complete history of your project's evolution, allowing you to review past analyses, compare changes over time, and track how your documentation and insights have developed. Product documentation goes to .shadow/docs, while architecture insights are stored in .shadow/insights.\n\nAll saved files use formatted markdown with proper structure and metadata, making them easy to read, version control, and integrate into your existing documentation workflows. The persistent storage means you can always access previous analyses without re-running expensive AI operations, and you can track how your codebase understanding has evolved across different time periods.",
  "files": [
    {
      "file": "src/infrastructure/persistence/analysisResultRepository.ts",
      "role": "Core Logic",
      "purpose": "Manages saving and organizing analysis results (product documentation, architecture insights, summaries) to disk in timestamped directories",
      "userVisibleActions": [
        "Analysis results are automatically saved to .shadow/docs and .shadow/insights directories",
        "Each analysis run creates a new timestamped folder to preserve history",
        "Product documentation files are saved with formatted markdown content",
        "Architecture insights are saved as structured markdown reports",
        "Project summaries are saved in markdown format with metadata",
        "All saved files are accessible for later review and comparison"
      ],
      "developerVisibleActions": [
        "Initialize a product documentation run to prepare storage location",
        "Initialize an architecture insights run to prepare storage location",
        "Save individual product documentation files with enhanced metadata",
        "Save architecture insights with categorized findings",
        "Save project summaries with key metrics and information",
        "Finalize runs to complete storage operations",
        "Storage automatically creates timestamped directory structures",
        "Files are organized by analysis type and timestamp"
      ],
      "keyFunctions": [
        {
          "name": "initializeProductDocsRun",
          "desc": "Creates a new timestamped directory for storing product documentation",
          "inputs": "workspaceRoot (string)",
          "outputs": "runDir path (string)"
        },
        {
          "name": "initializeArchitectureInsightsRun",
          "desc": "Creates a new timestamped directory for storing architecture insights",
          "inputs": "workspaceRoot (string)",
          "outputs": "runDir path (string)"
        },
        {
          "name": "saveProductDocumentation",
          "desc": "Saves enhanced product documentation to a markdown file",
          "inputs": "relativePath (string), documentation (EnhancedProductDocumentation)",
          "outputs": "void"
        },
        {
          "name": "saveArchitectureInsights",
          "desc": "Saves architecture analysis insights to a markdown file",
          "inputs": "insights (LLMInsights)",
          "outputs": "void"
        },
        {
          "name": "saveSummary",
          "desc": "Saves project analysis summary to a markdown file",
          "inputs": "summary (object with title, description, keyFeatures, etc.)",
          "outputs": "void"
        },
        {
          "name": "finalizeProductDocsRun",
          "desc": "Completes the product documentation run and cleans up",
          "inputs": "none",
          "outputs": "void"
        },
        {
          "name": "finalizeArchitectureInsightsRun",
          "desc": "Completes the architecture insights run and cleans up",
          "inputs": "none",
          "outputs": "void"
        },
        {
          "name": "getCurrentProductDocsRunDir",
          "desc": "Retrieves the current product documentation storage directory",
          "inputs": "none",
          "outputs": "runDir path (string or null)"
        },
        {
          "name": "getCurrentArchitectureInsightsRunDir",
          "desc": "Retrieves the current architecture insights storage directory",
          "inputs": "none",
          "outputs": "runDir path (string or null)"
        }
      ],
      "dependencies": [
        "vscode",
        "fs",
        "path",
        "../../fileDocumentation (EnhancedProductDocumentation)",
        "../../llmService (LLMInsights)",
        "../../domain/formatters/documentationFormatter (DocumentationFormatter)",
        "../../storage/incrementalStorage (createTimestampedStorage)"
      ],
      "intent": "This file exists to separate data persistence concerns from analysis logic, providing a clean interface for saving analysis results to disk while maintaining organized, timestamped storage that preserves historical analysis runs and makes results easily accessible for review.",
      "rawContent": "```json\n{\n  \"purpose\": \"Manages saving and organizing analysis results (product documentation, architecture insights, summaries) to disk in timestamped directories\",\n  \"userVisibleActions\": [\n    \"Analysis results are automatically saved to .shadow/docs and .shadow/insights directories\",\n    \"Each analysis run creates a new timestamped folder to preserve history\",\n    \"Product documentation files are saved with formatted markdown content\",\n    \"Architecture insights are saved as structured markdown reports\",\n    \"Project summaries are saved in markdown format with metadata\",\n    \"All saved files are accessible for later review and comparison\"\n  ],\n  \"developerVisibleActions\": [\n    \"Initialize a product documentation run to prepare storage location\",\n    \"Initialize an architecture insights run to prepare storage location\",\n    \"Save individual product documentation files with enhanced metadata\",\n    \"Save architecture insights with categorized findings\",\n    \"Save project summaries with key metrics and information\",\n    \"Finalize runs to complete storage operations\",\n    \"Storage automatically creates timestamped directory structures\",\n    \"Files are organized by analysis type and timestamp\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"initializeProductDocsRun\",\n      \"desc\": \"Creates a new timestamped directory for storing product documentation\",\n      \"inputs\": \"workspaceRoot (string)\",\n      \"outputs\": \"runDir path (string)\"\n    },\n    {\n      \"name\": \"initializeArchitectureInsightsRun\",\n      \"desc\": \"Creates a new timestamped directory for storing architecture insights\",\n      \"inputs\": \"workspaceRoot (string)\",\n      \"outputs\": \"runDir path (string)\"\n    },\n    {\n      \"name\": \"saveProductDocumentation\",\n      \"desc\": \"Saves enhanced product documentation to a markdown file\",\n      \"inputs\": \"relativePath (string), documentation (EnhancedProductDocumentation)\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"saveArchitectureInsights\",\n      \"desc\": \"Saves architecture analysis insights to a markdown file\",\n      \"inputs\": \"insights (LLMInsights)\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"saveSummary\",\n      \"desc\": \"Saves project analysis summary to a markdown file\",\n      \"inputs\": \"summary (object with title, description, keyFeatures, etc.)\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"finalizeProductDocsRun\",\n      \"desc\": \"Completes the product documentation run and cleans up\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"finalizeArchitectureInsightsRun\",\n      \"desc\": \"Completes the architecture insights run and cleans up\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"getCurrentProductDocsRunDir\",\n      \"desc\": \"Retrieves the current product documentation storage directory\",\n      \"inputs\": \"none\",\n      \"outputs\": \"runDir path (string or null)\"\n    },\n    {\n      \"name\": \"getCurrentArchitectureInsightsRunDir\",\n      \"desc\": \"Retrieves the current architecture insights storage directory\",\n      \"inputs\": \"none\",\n      \"outputs\": \"runDir path (string or null)\"\n    }\n  ],\n  \"dependencies\": [\n    \"vscode\",\n    \"fs\",\n    \"path\",\n    \"../../fileDocumentation (EnhancedProductDocumentation)\",\n    \"../../llmService (LLMInsights)\",\n    \"../../domain/formatters/documentationFormatter (DocumentationFormatter)\",\n    \"../../storage/incrementalStorage (createTimestampedStorage)\"\n  ],\n  \"intent\": \"This file exists to separate data persistence concerns from analysis logic, providing a clean interface for saving analysis results to disk while maintaining organized, timestamped storage that preserves historical analysis runs and makes results easily accessible for review.\"\n}\n```"
    }
  ],
  "endpoints": [],
  "commands": [],
  "workers": [],
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-19T21:27:03.922Z"
  }
}