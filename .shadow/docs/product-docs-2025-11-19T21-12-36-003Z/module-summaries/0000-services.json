{
  "module": "src/domain/services",
  "moduleType": "other",
  "capabilities": [
    "Automatically monitors and responds to file system changes across the workspace without requiring manual refresh",
    "Performs iterative analysis by making multiple rounds of file access and code searches until sufficient context is gathered",
    "Automatically detects test framework configuration and identifies missing dependencies or setup requirements",
    "Updates UI views and displays in real-time when relevant files are created, modified, or deleted",
    "Retrieves additional file content and grep search results automatically during analysis workflows",
    "Reports test framework readiness including TypeScript support and configuration file status"
  ],
  "summary": "The services module provides three core automation capabilities that enhance the developer experience. It monitors the workspace file system to detect changes in real-time, ensuring that views and displays stay synchronized with the current state of files without manual intervention. When users save documents or add new files, the system automatically responds and updates relevant UI components.\n\nThe module enables intelligent analysis workflows where the system iteratively requests additional files and performs code searches across multiple rounds until it has gathered sufficient context to complete tasks. Users see progress updates as the analysis proceeds, and the system automatically incorporates grep search results and file content as needed. This creates a seamless experience where complex analysis tasks are handled through multiple automated iterations.\n\nFor testing workflows, the module automatically detects which test framework is in use (Jest, Mocha, Vitest, or Pytest) and validates the configuration setup. It identifies missing dependencies, checks for proper TypeScript support, and reports whether test setup files are present. This ensures that generated tests will work correctly without requiring manual configuration by the user.",
  "files": [
    {
      "file": "src/domain/services/fileWatcherService.ts",
      "role": "Core Logic",
      "purpose": "Provides centralized file system watching capabilities to monitor and respond to file changes, creations, and deletions across the workspace",
      "userVisibleActions": [
        "Automatically detects when files are created, modified, or deleted in the workspace",
        "Responds to changes in specific file types (e.g., .feature files, .insights files) without manual refresh",
        "Updates UI views and displays when relevant files change",
        "Triggers automatic updates when saving documents"
      ],
      "developerVisibleActions": [
        "Register file watchers for specific patterns (e.g., '**/*.feature', '**/*.insights')",
        "Handle file creation, change, and deletion events with custom callbacks",
        "Watch for document save events across all text documents",
        "Filter file changes using ignore patterns to exclude unwanted files",
        "Unregister watchers when no longer needed to prevent memory leaks",
        "Dispose all watchers when extension deactivates"
      ],
      "keyFunctions": [
        {
          "name": "watch",
          "desc": "Creates a file system watcher for a specific pattern and registers a handler for file changes",
          "inputs": "id (string), pattern (glob pattern or RelativePattern), handler (callback function), options (ignorePatterns, watchCreate, watchChange, watchDelete)",
          "outputs": "Disposable object to stop watching"
        },
        {
          "name": "unwatch",
          "desc": "Removes a specific file watcher registration by its unique ID",
          "inputs": "id (string)",
          "outputs": "void"
        },
        {
          "name": "onDocumentSave",
          "desc": "Registers a handler to be called whenever any document is saved in the workspace",
          "inputs": "handler (callback function receiving TextDocument)",
          "outputs": "Disposable object to unregister the handler"
        },
        {
          "name": "getMatchingHandlers",
          "desc": "Finds all registered handlers that should process a given file URI",
          "inputs": "uri (file URI), patternKey (pattern identifier)",
          "outputs": "Set of PatternHandler objects"
        },
        {
          "name": "shouldIgnoreFile",
          "desc": "Determines if a file should be ignored based on configured ignore patterns",
          "inputs": "filePath (string), ignorePatterns (array of glob patterns)",
          "outputs": "boolean indicating whether to ignore the file"
        },
        {
          "name": "dispose",
          "desc": "Cleans up all watchers and handlers, releasing system resources",
          "inputs": "none",
          "outputs": "void"
        }
      ],
      "dependencies": [
        "vscode",
        "path",
        "fs"
      ],
      "intent": "This file consolidates file watching functionality that was previously duplicated across multiple files (fileWatcher.ts, productNavigator.ts, insightsViewer.ts). It provides a single, reusable service for monitoring file system changes, reducing code duplication and ensuring consistent file watching behavior throughout the extension. The service allows different parts of the extension to react to file changes without each implementing their own watcher logic, and it handles cleanup to prevent resource leaks.",
      "rawContent": "```json\n{\n  \"purpose\": \"Provides centralized file system watching capabilities to monitor and respond to file changes, creations, and deletions across the workspace\",\n  \"userVisibleActions\": [\n    \"Automatically detects when files are created, modified, or deleted in the workspace\",\n    \"Responds to changes in specific file types (e.g., .feature files, .insights files) without manual refresh\",\n    \"Updates UI views and displays when relevant files change\",\n    \"Triggers automatic updates when saving documents\"\n  ],\n  \"developerVisibleActions\": [\n    \"Register file watchers for specific patterns (e.g., '**/*.feature', '**/*.insights')\",\n    \"Handle file creation, change, and deletion events with custom callbacks\",\n    \"Watch for document save events across all text documents\",\n    \"Filter file changes using ignore patterns to exclude unwanted files\",\n    \"Unregister watchers when no longer needed to prevent memory leaks\",\n    \"Dispose all watchers when extension deactivates\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"watch\",\n      \"desc\": \"Creates a file system watcher for a specific pattern and registers a handler for file changes\",\n      \"inputs\": \"id (string), pattern (glob pattern or RelativePattern), handler (callback function), options (ignorePatterns, watchCreate, watchChange, watchDelete)\",\n      \"outputs\": \"Disposable object to stop watching\"\n    },\n    {\n      \"name\": \"unwatch\",\n      \"desc\": \"Removes a specific file watcher registration by its unique ID\",\n      \"inputs\": \"id (string)\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"onDocumentSave\",\n      \"desc\": \"Registers a handler to be called whenever any document is saved in the workspace\",\n      \"inputs\": \"handler (callback function receiving TextDocument)\",\n      \"outputs\": \"Disposable object to unregister the handler\"\n    },\n    {\n      \"name\": \"getMatchingHandlers\",\n      \"desc\": \"Finds all registered handlers that should process a given file URI\",\n      \"inputs\": \"uri (file URI), patternKey (pattern identifier)\",\n      \"outputs\": \"Set of PatternHandler objects\"\n    },\n    {\n      \"name\": \"shouldIgnoreFile\",\n      \"desc\": \"Determines if a file should be ignored based on configured ignore patterns\",\n      \"inputs\": \"filePath (string), ignorePatterns (array of glob patterns)\",\n      \"outputs\": \"boolean indicating whether to ignore the file\"\n    },\n    {\n      \"name\": \"dispose\",\n      \"desc\": \"Cleans up all watchers and handlers, releasing system resources\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    }\n  ],\n  \"dependencies\": [\n    \"vscode\",\n    \"path\",\n    \"fs\"\n  ],\n  \"intent\": \"This file consolidates file watching functionality that was previously duplicated across multiple files (fileWatcher.ts, productNavigator.ts, insightsViewer.ts). It provides a single, reusable service for monitoring file system changes, reducing code duplication and ensuring consistent file watching behavior throughout the extension. The service allows different parts of the extension to react to file changes without each implementing their own watcher logic, and it handles cleanup to prevent resource leaks.\"\n}\n```"
    },
    {
      "file": "src/domain/services/incrementalAnalysisService.ts",
      "role": "Core Logic",
      "purpose": "Handles iterative analysis where an LLM makes multiple requests for files or code searches until it has enough information to complete its task",
      "userVisibleActions": [
        "User receives analysis results that may require multiple rounds of file access and code searching",
        "User sees progress updates as the system iterates through analysis rounds",
        "User experiences automatic retrieval of additional file content when the LLM needs more context",
        "User gets grep search results automatically incorporated into analysis when patterns need to be found"
      ],
      "developerVisibleActions": [
        "Developer triggers incremental analysis that automatically handles LLM requests for more information",
        "Developer receives iteration callbacks showing progress through analysis rounds",
        "Developer gets structured results containing the final analysis, iteration count, and all requests made",
        "Developer can configure maximum iterations to prevent infinite loops",
        "Developer sees file read and grep search requests processed automatically up to 5 requests per iteration",
        "Developer receives conversation messages with assistant responses and user-provided additional information"
      ],
      "keyFunctions": [
        {
          "name": "processRequests",
          "desc": "Processes LLM requests for files and grep searches, returning formatted additional information and updated conversation messages",
          "inputs": "requests: LLMRequest[], currentResult: any, messages: conversation array",
          "outputs": "ProcessRequestsResult with additionalInfo string and updated messages array"
        },
        {
          "name": "IterationResult<T>",
          "desc": "Structure containing the final result, iteration count, all requests made, and whether to continue",
          "inputs": "Generic type T for result",
          "outputs": "result: T, iteration: number, maxIterations: number, requests: LLMRequest[], shouldContinue: boolean"
        },
        {
          "name": "IterationCallbacks<T>",
          "desc": "Optional callbacks for monitoring iteration progress",
          "inputs": "Generic type T for result",
          "outputs": "onIterationStart and onIterationComplete callback functions"
        }
      ],
      "dependencies": [
        "fileAccessHelper",
        "LLMRequest type definitions"
      ],
      "intent": "This file exists to eliminate code duplication and improve testability by extracting the iterative LLM analysis pattern into a reusable service. It solves the problem of LLMs needing multiple rounds of information gathering (file reads, grep searches) before completing an analysis, converting while-loop patterns into async iterator patterns that are easier to test and maintain.",
      "rawContent": "```json\n{\n  \"purpose\": \"Handles iterative analysis where an LLM makes multiple requests for files or code searches until it has enough information to complete its task\",\n  \"userVisibleActions\": [\n    \"User receives analysis results that may require multiple rounds of file access and code searching\",\n    \"User sees progress updates as the system iterates through analysis rounds\",\n    \"User experiences automatic retrieval of additional file content when the LLM needs more context\",\n    \"User gets grep search results automatically incorporated into analysis when patterns need to be found\"\n  ],\n  \"developerVisibleActions\": [\n    \"Developer triggers incremental analysis that automatically handles LLM requests for more information\",\n    \"Developer receives iteration callbacks showing progress through analysis rounds\",\n    \"Developer gets structured results containing the final analysis, iteration count, and all requests made\",\n    \"Developer can configure maximum iterations to prevent infinite loops\",\n    \"Developer sees file read and grep search requests processed automatically up to 5 requests per iteration\",\n    \"Developer receives conversation messages with assistant responses and user-provided additional information\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"processRequests\",\n      \"desc\": \"Processes LLM requests for files and grep searches, returning formatted additional information and updated conversation messages\",\n      \"inputs\": \"requests: LLMRequest[], currentResult: any, messages: conversation array\",\n      \"outputs\": \"ProcessRequestsResult with additionalInfo string and updated messages array\"\n    },\n    {\n      \"name\": \"IterationResult<T>\",\n      \"desc\": \"Structure containing the final result, iteration count, all requests made, and whether to continue\",\n      \"inputs\": \"Generic type T for result\",\n      \"outputs\": \"result: T, iteration: number, maxIterations: number, requests: LLMRequest[], shouldContinue: boolean\"\n    },\n    {\n      \"name\": \"IterationCallbacks<T>\",\n      \"desc\": \"Optional callbacks for monitoring iteration progress\",\n      \"inputs\": \"Generic type T for result\",\n      \"outputs\": \"onIterationStart and onIterationComplete callback functions\"\n    }\n  ],\n  \"dependencies\": [\n    \"fileAccessHelper\",\n    \"LLMRequest type definitions\"\n  ],\n  \"intent\": \"This file exists to eliminate code duplication and improve testability by extracting the iterative LLM analysis pattern into a reusable service. It solves the problem of LLMs needing multiple rounds of information gathering (file reads, grep searches) before completing an analysis, converting while-loop patterns into async iterator patterns that are easier to test and maintain.\"\n}\n```"
    },
    {
      "file": "src/domain/services/testConfigurationService.ts",
      "role": "Core Logic",
      "purpose": "Automatically detects test framework configuration (Jest, Mocha, Vitest, Pytest) and identifies missing dependencies or setup requirements to ensure generated tests work without manual configuration.",
      "userVisibleActions": [
        "Automatically detects which test framework is being used in the workspace (Jest, Mocha, Vitest, or Pytest)",
        "Identifies missing test dependencies that need to be installed",
        "Shows configuration status indicating whether tests are ready to run",
        "Reports whether TypeScript support is properly configured for the test framework",
        "Indicates if test setup files or configuration files are missing"
      ],
      "developerVisibleActions": [
        "Scans package.json to detect test scripts and installed test framework dependencies",
        "Checks for framework-specific configuration files (jest.config.js, mocha.opts, vitest.config.ts, pytest.ini)",
        "Detects if TypeScript is used and validates TypeScript test support (ts-jest, @types packages)",
        "Returns detailed status including framework type, configuration state, and required setup actions",
        "Provides list of missing dependencies that need installation",
        "Determines if additional setup is required before tests can be generated"
      ],
      "keyFunctions": [
        {
          "name": "detectTestConfiguration",
          "desc": "Analyzes workspace to determine test framework, configuration status, and missing dependencies",
          "inputs": "workspaceRoot: string (path to workspace folder)",
          "outputs": "TestConfigStatus object with framework type, configuration state, missing dependencies, and setup actions"
        }
      ],
      "dependencies": [
        "fs",
        "path",
        "SWLogger"
      ],
      "intent": "Eliminates manual test configuration by automatically detecting the test framework and setup requirements, ensuring that AI-generated tests work immediately without requiring users to manually configure test environments or install missing dependencies.",
      "rawContent": "```json\n{\n  \"purpose\": \"Automatically detects test framework configuration (Jest, Mocha, Vitest, Pytest) and identifies missing dependencies or setup requirements to ensure generated tests work without manual configuration.\",\n  \"userVisibleActions\": [\n    \"Automatically detects which test framework is being used in the workspace (Jest, Mocha, Vitest, or Pytest)\",\n    \"Identifies missing test dependencies that need to be installed\",\n    \"Shows configuration status indicating whether tests are ready to run\",\n    \"Reports whether TypeScript support is properly configured for the test framework\",\n    \"Indicates if test setup files or configuration files are missing\"\n  ],\n  \"developerVisibleActions\": [\n    \"Scans package.json to detect test scripts and installed test framework dependencies\",\n    \"Checks for framework-specific configuration files (jest.config.js, mocha.opts, vitest.config.ts, pytest.ini)\",\n    \"Detects if TypeScript is used and validates TypeScript test support (ts-jest, @types packages)\",\n    \"Returns detailed status including framework type, configuration state, and required setup actions\",\n    \"Provides list of missing dependencies that need installation\",\n    \"Determines if additional setup is required before tests can be generated\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"detectTestConfiguration\",\n      \"desc\": \"Analyzes workspace to determine test framework, configuration status, and missing dependencies\",\n      \"inputs\": \"workspaceRoot: string (path to workspace folder)\",\n      \"outputs\": \"TestConfigStatus object with framework type, configuration state, missing dependencies, and setup actions\"\n    }\n  ],\n  \"dependencies\": [\n    \"fs\",\n    \"path\",\n    \"SWLogger\"\n  ],\n  \"intent\": \"Eliminates manual test configuration by automatically detecting the test framework and setup requirements, ensuring that AI-generated tests work immediately without requiring users to manually configure test environments or install missing dependencies.\"\n}\n```"
    }
  ],
  "endpoints": [],
  "commands": [],
  "workers": [],
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-19T21:26:46.898Z"
  }
}