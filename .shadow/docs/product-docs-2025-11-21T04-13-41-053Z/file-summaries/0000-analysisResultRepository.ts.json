{
  "file": "src/infrastructure/persistence/analysisResultRepository.ts",
  "role": "Core Logic",
  "purpose": "Manages saving and organizing analysis results (product documentation, architecture insights, and summaries) to disk in timestamped directories.",
  "userVisibleActions": [
    "Analysis results are automatically saved to .shadow/docs directory",
    "Each analysis run creates a timestamped folder with organized documentation",
    "Product documentation is saved as individual files per analyzed file",
    "Architecture insights are saved as a consolidated summary",
    "Progress summaries show files processed and time taken",
    "All documentation files are formatted in markdown"
  ],
  "developerVisibleActions": [
    "Initialize product documentation runs to start saving results",
    "Initialize architecture insights runs for system-level analysis",
    "Save individual file documentation with metadata",
    "Save architecture insights with processing statistics",
    "Append incremental documentation as files are processed",
    "Generate summary reports at the end of analysis runs",
    "Store results in .shadow/docs with timestamped run directories",
    "Access run metadata like start time and directory paths"
  ],
  "keyFunctions": [
    {
      "name": "initializeProductDocsRun",
      "desc": "Creates a new timestamped directory for storing product documentation",
      "inputs": "workspaceRoot: string",
      "outputs": "string (path to run directory)"
    },
    {
      "name": "initializeArchitectureInsightsRun",
      "desc": "Creates a new timestamped directory for storing architecture insights",
      "inputs": "workspaceRoot: string",
      "outputs": "string (path to run directory)"
    },
    {
      "name": "saveProductDocumentation",
      "desc": "Saves enhanced product documentation for a single file",
      "inputs": "doc: EnhancedProductDocumentation, workspaceRoot: string",
      "outputs": "Promise<void>"
    },
    {
      "name": "saveArchitectureInsights",
      "desc": "Saves architecture insights with processing metadata",
      "inputs": "insights: LLMInsights, filesProcessed: number, timeElapsed: number, workspaceRoot: string",
      "outputs": "Promise<void>"
    },
    {
      "name": "appendProductDocumentation",
      "desc": "Appends documentation incrementally during processing",
      "inputs": "doc: EnhancedProductDocumentation, workspaceRoot: string",
      "outputs": "Promise<void>"
    },
    {
      "name": "generateProductDocsSummary",
      "desc": "Creates a summary report of all processed files",
      "inputs": "filesProcessed: number, workspaceRoot: string",
      "outputs": "Promise<void>"
    },
    {
      "name": "generateArchitectureInsightsSummary",
      "desc": "Creates a summary report of architecture analysis",
      "inputs": "insights: LLMInsights, filesProcessed: number, workspaceRoot: string",
      "outputs": "Promise<void>"
    },
    {
      "name": "getCurrentProductDocsRunDir",
      "desc": "Gets the current product docs run directory path",
      "inputs": "none",
      "outputs": "string | null"
    },
    {
      "name": "getCurrentArchitectureInsightsRunDir",
      "desc": "Gets the current architecture insights run directory path",
      "inputs": "none",
      "outputs": "string | null"
    },
    {
      "name": "resetProductDocsRun",
      "desc": "Clears the current product docs run context",
      "inputs": "none",
      "outputs": "void"
    },
    {
      "name": "resetArchitectureInsightsRun",
      "desc": "Clears the current architecture insights run context",
      "inputs": "none",
      "outputs": "void"
    }
  ],
  "dependencies": [
    "vscode",
    "fs",
    "path",
    "../../fileDocumentation (EnhancedProductDocumentation)",
    "../../llmService (LLMInsights)",
    "../../domain/formatters/documentationFormatter (DocumentationFormatter)",
    "../../storage/incrementalStorage (createTimestampedStorage)"
  ],
  "intent": "This repository separates persistence concerns from analysis logic, providing a dedicated layer for saving analysis results to disk in an organized, timestamped structure that allows multiple runs to coexist and makes it easy to track when analyses were performed.",
  "rawContent": "```json\n{\n  \"purpose\": \"Manages saving and organizing analysis results (product documentation, architecture insights, and summaries) to disk in timestamped directories.\",\n  \"userVisibleActions\": [\n    \"Analysis results are automatically saved to .shadow/docs directory\",\n    \"Each analysis run creates a timestamped folder with organized documentation\",\n    \"Product documentation is saved as individual files per analyzed file\",\n    \"Architecture insights are saved as a consolidated summary\",\n    \"Progress summaries show files processed and time taken\",\n    \"All documentation files are formatted in markdown\"\n  ],\n  \"developerVisibleActions\": [\n    \"Initialize product documentation runs to start saving results\",\n    \"Initialize architecture insights runs for system-level analysis\",\n    \"Save individual file documentation with metadata\",\n    \"Save architecture insights with processing statistics\",\n    \"Append incremental documentation as files are processed\",\n    \"Generate summary reports at the end of analysis runs\",\n    \"Store results in .shadow/docs with timestamped run directories\",\n    \"Access run metadata like start time and directory paths\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"initializeProductDocsRun\",\n      \"desc\": \"Creates a new timestamped directory for storing product documentation\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"string (path to run directory)\"\n    },\n    {\n      \"name\": \"initializeArchitectureInsightsRun\",\n      \"desc\": \"Creates a new timestamped directory for storing architecture insights\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"string (path to run directory)\"\n    },\n    {\n      \"name\": \"saveProductDocumentation\",\n      \"desc\": \"Saves enhanced product documentation for a single file\",\n      \"inputs\": \"doc: EnhancedProductDocumentation, workspaceRoot: string\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"saveArchitectureInsights\",\n      \"desc\": \"Saves architecture insights with processing metadata\",\n      \"inputs\": \"insights: LLMInsights, filesProcessed: number, timeElapsed: number, workspaceRoot: string\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"appendProductDocumentation\",\n      \"desc\": \"Appends documentation incrementally during processing\",\n      \"inputs\": \"doc: EnhancedProductDocumentation, workspaceRoot: string\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"generateProductDocsSummary\",\n      \"desc\": \"Creates a summary report of all processed files\",\n      \"inputs\": \"filesProcessed: number, workspaceRoot: string\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"generateArchitectureInsightsSummary\",\n      \"desc\": \"Creates a summary report of architecture analysis\",\n      \"inputs\": \"insights: LLMInsights, filesProcessed: number, workspaceRoot: string\",\n      \"outputs\": \"Promise<void>\"\n    },\n    {\n      \"name\": \"getCurrentProductDocsRunDir\",\n      \"desc\": \"Gets the current product docs run directory path\",\n      \"inputs\": \"none\",\n      \"outputs\": \"string | null\"\n    },\n    {\n      \"name\": \"getCurrentArchitectureInsightsRunDir\",\n      \"desc\": \"Gets the current architecture insights run directory path\",\n      \"inputs\": \"none\",\n      \"outputs\": \"string | null\"\n    },\n    {\n      \"name\": \"resetProductDocsRun\",\n      \"desc\": \"Clears the current product docs run context\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"resetArchitectureInsightsRun\",\n      \"desc\": \"Clears the current architecture insights run context\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    }\n  ],\n  \"dependencies\": [\n    \"vscode\",\n    \"fs\",\n    \"path\",\n    \"../../fileDocumentation (EnhancedProductDocumentation)\",\n    \"../../llmService (LLMInsights)\",\n    \"../../domain/formatters/documentationFormatter (DocumentationFormatter)\",\n    \"../../storage/incrementalStorage (createTimestampedStorage)\"\n  ],\n  \"intent\": \"This repository separates persistence concerns from analysis logic, providing a dedicated layer for saving analysis results to disk in an organized, timestamped structure that allows multiple runs to coexist and makes it easy to track when analyses were performed.\"\n}\n```",
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-21T04:22:05.330Z"
  }
}