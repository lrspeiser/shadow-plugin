{
  "file": "src/domain/prompts/refactoringPromptBuilder.ts",
  "role": "Core Logic",
  "purpose": "Builds detailed, prescriptive prompts for AI-powered code refactoring by analyzing functions and creating structured extraction plans",
  "userVisibleActions": [
    "Receives detailed refactoring recommendations with specific function extraction plans",
    "Sees migration steps explaining how to move code between files",
    "Views before/after code examples showing proposed refactoring changes",
    "Gets prescriptive instructions for breaking down large files into smaller modules"
  ],
  "developerVisibleActions": [
    "Provides code analysis data including file information and function metadata",
    "Supplies optional product documentation to guide refactoring decisions",
    "Passes architecture insights to inform refactoring strategy",
    "Receives structured refactoring prompts ready to send to LLM services",
    "Gets function dependency analysis showing which functions call each other",
    "Obtains extraction plans specifying source files, target files, and migration steps"
  ],
  "keyFunctions": [
    {
      "name": "buildDetailedRefactoringPrompt",
      "desc": "Creates a comprehensive refactoring prompt by combining code analysis, product documentation, architecture insights, and function analyses",
      "inputs": "AnalysisContext, CodeAnalysis, optional EnhancedProductDocumentation, optional LLMInsights, optional FunctionAnalysis[]",
      "outputs": "string prompt ready for LLM consumption"
    },
    {
      "name": "buildBasePrompt",
      "desc": "Constructs the foundational refactoring prompt with context and code analysis",
      "inputs": "AnalysisContext, CodeAnalysis, optional EnhancedProductDocumentation, optional LLMInsights",
      "outputs": "string base prompt"
    },
    {
      "name": "buildFunctionAnalysisSection",
      "desc": "Adds detailed function-level analysis to the prompt showing dependencies, responsibilities, and metrics",
      "inputs": "FunctionAnalysis[]",
      "outputs": "string section describing function details"
    },
    {
      "name": "buildExtractionRequirementsSection",
      "desc": "Generates requirements for code extraction including target files, dependencies, and migration steps",
      "inputs": "none apparent",
      "outputs": "string section with extraction guidelines"
    }
  ],
  "dependencies": [
    "../../analyzer",
    "../../llmService",
    "../../fileDocumentation"
  ],
  "intent": "This file exists to transform raw code analysis data into structured, actionable refactoring instructions that an LLM can understand and execute. It solves the problem of providing enough context and detail so that AI-generated refactoring recommendations are accurate, safe, and preserve code relationships like dependencies between functions.",
  "rawContent": "```json\n{\n  \"purpose\": \"Builds detailed, prescriptive prompts for AI-powered code refactoring by analyzing functions and creating structured extraction plans\",\n  \"userVisibleActions\": [\n    \"Receives detailed refactoring recommendations with specific function extraction plans\",\n    \"Sees migration steps explaining how to move code between files\",\n    \"Views before/after code examples showing proposed refactoring changes\",\n    \"Gets prescriptive instructions for breaking down large files into smaller modules\"\n  ],\n  \"developerVisibleActions\": [\n    \"Provides code analysis data including file information and function metadata\",\n    \"Supplies optional product documentation to guide refactoring decisions\",\n    \"Passes architecture insights to inform refactoring strategy\",\n    \"Receives structured refactoring prompts ready to send to LLM services\",\n    \"Gets function dependency analysis showing which functions call each other\",\n    \"Obtains extraction plans specifying source files, target files, and migration steps\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"buildDetailedRefactoringPrompt\",\n      \"desc\": \"Creates a comprehensive refactoring prompt by combining code analysis, product documentation, architecture insights, and function analyses\",\n      \"inputs\": \"AnalysisContext, CodeAnalysis, optional EnhancedProductDocumentation, optional LLMInsights, optional FunctionAnalysis[]\",\n      \"outputs\": \"string prompt ready for LLM consumption\"\n    },\n    {\n      \"name\": \"buildBasePrompt\",\n      \"desc\": \"Constructs the foundational refactoring prompt with context and code analysis\",\n      \"inputs\": \"AnalysisContext, CodeAnalysis, optional EnhancedProductDocumentation, optional LLMInsights\",\n      \"outputs\": \"string base prompt\"\n    },\n    {\n      \"name\": \"buildFunctionAnalysisSection\",\n      \"desc\": \"Adds detailed function-level analysis to the prompt showing dependencies, responsibilities, and metrics\",\n      \"inputs\": \"FunctionAnalysis[]\",\n      \"outputs\": \"string section describing function details\"\n    },\n    {\n      \"name\": \"buildExtractionRequirementsSection\",\n      \"desc\": \"Generates requirements for code extraction including target files, dependencies, and migration steps\",\n      \"inputs\": \"none apparent\",\n      \"outputs\": \"string section with extraction guidelines\"\n    }\n  ],\n  \"dependencies\": [\n    \"../../analyzer\",\n    \"../../llmService\",\n    \"../../fileDocumentation\"\n  ],\n  \"intent\": \"This file exists to transform raw code analysis data into structured, actionable refactoring instructions that an LLM can understand and execute. It solves the problem of providing enough context and detail so that AI-generated refactoring recommendations are accurate, safe, and preserve code relationships like dependencies between functions.\"\n}\n```",
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-21T04:18:14.936Z"
  }
}