{
  "module": "src/infrastructure/persistence",
  "moduleType": "other",
  "capabilities": [
    "Automatically persists all analysis results to disk with timestamped organization",
    "Stores product documentation in organized run folders within .shadow/docs directory",
    "Maintains historical tracking of architecture insights with timestamps",
    "Creates and manages summary documents in dedicated .shadow/summary directory",
    "Preserves complete analysis history through timestamped folder structure"
  ],
  "summary": "This module provides persistent storage capabilities for all codebase analysis results. It automatically saves analysis outputs to the local filesystem, organizing them into structured directories within the .shadow folder. Each analysis run creates a new timestamped folder, ensuring that historical results are preserved and easily accessible.\n\nThe module handles multiple types of documentation artifacts including product documentation, architecture insights, and summary documents. All results are stored with timestamps, allowing users to track how their codebase documentation evolves over time. The organized folder structure makes it easy to locate specific analysis runs and compare results across different points in time.\n\nUsers benefit from automatic persistence without manual intervention - every analysis automatically generates and saves results to predictable locations. The timestamped storage ensures that no previous analysis is overwritten, providing a complete audit trail of documentation changes and architectural evolution.",
  "files": [
    {
      "file": "src/infrastructure/persistence/analysisResultRepository.ts",
      "role": "Core Logic",
      "purpose": "Manages saving and retrieving analysis results like product documentation, architecture insights, and summaries to disk with timestamped storage.",
      "userVisibleActions": [
        "Analysis results are automatically saved to .shadow/docs folder with timestamps",
        "Product documentation is generated and stored in organized run folders",
        "Architecture insights are saved with timestamps for historical tracking",
        "Summary documents are created in the .shadow/summary directory",
        "Each analysis run creates a new timestamped folder to preserve history"
      ],
      "developerVisibleActions": [
        "Initialize product documentation runs to create storage directories",
        "Initialize architecture insights runs to create separate storage locations",
        "Save individual product documentation for specific files",
        "Save architecture insights for the entire codebase",
        "Save summary documents with aggregated analysis results",
        "Retrieve the most recent product documentation for a file",
        "Retrieve the most recent architecture insights",
        "Access all product documentation from the current run",
        "Get the current run directory path for organizing outputs",
        "Finalize runs to complete the analysis session"
      ],
      "keyFunctions": [
        {
          "name": "initializeProductDocsRun",
          "desc": "Creates a new timestamped run for storing product documentation",
          "inputs": "workspaceRoot: string",
          "outputs": "runDir path as string"
        },
        {
          "name": "initializeArchitectureInsightsRun",
          "desc": "Creates a new timestamped run for storing architecture insights",
          "inputs": "workspaceRoot: string",
          "outputs": "runDir path as string"
        },
        {
          "name": "saveProductDocumentation",
          "desc": "Saves product documentation for a specific file to the current run folder",
          "inputs": "filePath: string, documentation: EnhancedProductDocumentation, workspaceRoot: string",
          "outputs": "void"
        },
        {
          "name": "saveArchitectureInsights",
          "desc": "Saves architecture insights to the current run folder",
          "inputs": "insights: LLMInsights, workspaceRoot: string",
          "outputs": "void"
        },
        {
          "name": "saveSummaryDocument",
          "desc": "Saves a summary document combining all documentation and insights",
          "inputs": "summary content and metadata, workspaceRoot: string",
          "outputs": "void"
        },
        {
          "name": "getLatestProductDocumentation",
          "desc": "Retrieves the most recent product documentation for a given file",
          "inputs": "filePath: string, workspaceRoot: string",
          "outputs": "EnhancedProductDocumentation or null"
        },
        {
          "name": "getLatestArchitectureInsights",
          "desc": "Retrieves the most recent architecture insights",
          "inputs": "workspaceRoot: string",
          "outputs": "LLMInsights or null"
        },
        {
          "name": "getAllProductDocsFromCurrentRun",
          "desc": "Gets all product documentation saved in the current run",
          "inputs": "none",
          "outputs": "Map of file paths to documentation"
        },
        {
          "name": "getCurrentRunDir",
          "desc": "Returns the directory path for the current product docs run",
          "inputs": "none",
          "outputs": "runDir path as string or null"
        },
        {
          "name": "finalizeProductDocsRun",
          "desc": "Completes the current product documentation run session",
          "inputs": "none",
          "outputs": "void"
        },
        {
          "name": "finalizeArchitectureInsightsRun",
          "desc": "Completes the current architecture insights run session",
          "inputs": "none",
          "outputs": "void"
        }
      ],
      "dependencies": [
        "vscode",
        "fs",
        "path",
        "EnhancedProductDocumentation from fileDocumentation",
        "LLMInsights from llmService",
        "DocumentationFormatter from domain/formatters",
        "createTimestampedStorage from storage/incrementalStorage"
      ],
      "intent": "Separates data persistence logic from business logic by providing a dedicated repository for managing analysis results storage, enabling historical tracking of documentation and insights through timestamped runs, and organizing outputs in a structured directory hierarchy.",
      "rawContent": "```json\n{\n  \"purpose\": \"Manages saving and retrieving analysis results like product documentation, architecture insights, and summaries to disk with timestamped storage.\",\n  \"userVisibleActions\": [\n    \"Analysis results are automatically saved to .shadow/docs folder with timestamps\",\n    \"Product documentation is generated and stored in organized run folders\",\n    \"Architecture insights are saved with timestamps for historical tracking\",\n    \"Summary documents are created in the .shadow/summary directory\",\n    \"Each analysis run creates a new timestamped folder to preserve history\"\n  ],\n  \"developerVisibleActions\": [\n    \"Initialize product documentation runs to create storage directories\",\n    \"Initialize architecture insights runs to create separate storage locations\",\n    \"Save individual product documentation for specific files\",\n    \"Save architecture insights for the entire codebase\",\n    \"Save summary documents with aggregated analysis results\",\n    \"Retrieve the most recent product documentation for a file\",\n    \"Retrieve the most recent architecture insights\",\n    \"Access all product documentation from the current run\",\n    \"Get the current run directory path for organizing outputs\",\n    \"Finalize runs to complete the analysis session\"\n  ],\n  \"keyFunctions\": [\n    {\n      \"name\": \"initializeProductDocsRun\",\n      \"desc\": \"Creates a new timestamped run for storing product documentation\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"runDir path as string\"\n    },\n    {\n      \"name\": \"initializeArchitectureInsightsRun\",\n      \"desc\": \"Creates a new timestamped run for storing architecture insights\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"runDir path as string\"\n    },\n    {\n      \"name\": \"saveProductDocumentation\",\n      \"desc\": \"Saves product documentation for a specific file to the current run folder\",\n      \"inputs\": \"filePath: string, documentation: EnhancedProductDocumentation, workspaceRoot: string\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"saveArchitectureInsights\",\n      \"desc\": \"Saves architecture insights to the current run folder\",\n      \"inputs\": \"insights: LLMInsights, workspaceRoot: string\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"saveSummaryDocument\",\n      \"desc\": \"Saves a summary document combining all documentation and insights\",\n      \"inputs\": \"summary content and metadata, workspaceRoot: string\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"getLatestProductDocumentation\",\n      \"desc\": \"Retrieves the most recent product documentation for a given file\",\n      \"inputs\": \"filePath: string, workspaceRoot: string\",\n      \"outputs\": \"EnhancedProductDocumentation or null\"\n    },\n    {\n      \"name\": \"getLatestArchitectureInsights\",\n      \"desc\": \"Retrieves the most recent architecture insights\",\n      \"inputs\": \"workspaceRoot: string\",\n      \"outputs\": \"LLMInsights or null\"\n    },\n    {\n      \"name\": \"getAllProductDocsFromCurrentRun\",\n      \"desc\": \"Gets all product documentation saved in the current run\",\n      \"inputs\": \"none\",\n      \"outputs\": \"Map of file paths to documentation\"\n    },\n    {\n      \"name\": \"getCurrentRunDir\",\n      \"desc\": \"Returns the directory path for the current product docs run\",\n      \"inputs\": \"none\",\n      \"outputs\": \"runDir path as string or null\"\n    },\n    {\n      \"name\": \"finalizeProductDocsRun\",\n      \"desc\": \"Completes the current product documentation run session\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    },\n    {\n      \"name\": \"finalizeArchitectureInsightsRun\",\n      \"desc\": \"Completes the current architecture insights run session\",\n      \"inputs\": \"none\",\n      \"outputs\": \"void\"\n    }\n  ],\n  \"dependencies\": [\n    \"vscode\",\n    \"fs\",\n    \"path\",\n    \"EnhancedProductDocumentation from fileDocumentation\",\n    \"LLMInsights from llmService\",\n    \"DocumentationFormatter from domain/formatters\",\n    \"createTimestampedStorage from storage/incrementalStorage\"\n  ],\n  \"intent\": \"Separates data persistence logic from business logic by providing a dedicated repository for managing analysis results storage, enabling historical tracking of documentation and insights through timestamped runs, and organizing outputs in a structured directory hierarchy.\"\n}\n```"
    }
  ],
  "endpoints": [],
  "commands": [],
  "workers": [],
  "_metadata": {
    "index": 0,
    "total": 0,
    "savedAt": "2025-11-21T17:51:53.163Z"
  }
}